<!DOCTYPE html>
<head>
  <title>Accumulator Test</title>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col">
        <dl>
          <dt>Users Data</dt>
          <dd><button id="btn-load-data">- NOT LOADED -</button></dd>
          <dt>Object.assign</dt>
          <dd><button id="btn-test-assign">- NOT TESTED -</button></dd>
          <dt>Accumulator</dt>
          <dd><button id="btn-test-accumulator">- NOT TESTED -</button></dd>
        </dl>
      </div>
    </div>
  </div>
  <script src="./scripts/accumulator.js"></script>
  <script>
    let userData = undefined;
    function updateUserDataStatus(){
      if(userData === undefined){
        document.getElementById("btn-load-data").textContent = "- NOT LOADED -"
      }else if(userData.length === 0){
        document.getElementById("btn-load-data").textContent = "EMPTY"
      }else{
        document.getElementById("btn-load-data").textContent = "Length: " + userData.length
      }
    }

    document.getElementById("btn-load-data").addEventListener("click", function(e){
      document.getElementById("btn-load-data").textContent = "Loading..."
      fetch("./test-users.json").then(data => {
         data.json().then(j => {
          userData = j
          updateUserDataStatus();
        });
      })
    })

    document.getElementById("btn-test-assign").addEventListener("click", function(){
      if(userData === undefined){
        return;
      }
      const t1 = performance.now();
      const user = Object.assign({}, ...userData);
      const t2 = performance.now();
      document.getElementById("btn-test-assign").textContent = t2 - t1;
      alert(JSON.stringify(user));
    })

    document.getElementById("btn-test-accumulator").addEventListener("click", function(){
      if(userData === undefined){
        return;
      }
      const t1 = performance.now();
      const ac = ObjectAccumulator.Accumulator.from(userData);
      const country = ac.e("country");
      const t2 = performance.now();
      document.getElementById("btn-test-accumulator").textContent = t2 - t1;
      alert(country);
    })

    updateUserDataStatus();
  </script>
</body>
</html>
