<!DOCTYPE html>
<head>
  <title>Accumulator Test</title>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col">
        <dl>
          <dt>Users Data: <span id="user-load-status">- NOT LOADED -</dt>
          <dd>
            <button id="btn-load-10000">Load 10000</button>
            <button id="btn-load-25000">Load 25000</button>
            <button id="btn-load-50000">Load 50000</button>
            <button id="btn-load-100000">Load 100000</button>
            <button id="btn-load-500000">Load 500000</button>
          </dd>
          <dt>Accumulator</dt>
          <dd>
            <button id="btn-test-accumulator">- NOT TESTED -</button>
            </br>
            <textarea id="textarea-test-accumulator"></textarea>
          </dd>
          <dt>Object.assign</dt>
          <dd>
            <button id="btn-test-assign">- NOT TESTED -</button>
            </br>
            <textarea id="textarea-test-assign"></textarea>
          </dd>
          <dt>deepmerge</dt>
          <dd>
            <button id="btn-test-deepmerge">- NOT TESTED -</button>
            </br>
            <textarea id="textarea-test-deepmerge"></textarea>
          </dd>
          <dt>Map</dt>
          <dd><button id="btn-test-map" disabled>- NOT AVAILABLE -</button></dd>
        </dl>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/deepmerge@4.0.0/dist/umd.js"></script>
  <script src="./scripts/accumulator.js"></script>
  <script>
    let userData = undefined;
    function updateUserDataStatus(){
      if(userData === undefined){
        document.getElementById("user-load-status").textContent = "- NOT LOADED -"
      }else if(userData.length === 0){
        document.getElementById("user-load-status").textContent = "EMPTY"
      }else{
        document.getElementById("user-load-status").textContent = "Length: " + userData.length
      }
    }

    function setLoadDataButton(amount){
      document.getElementById("btn-load-" + amount).addEventListener("click", function(e){
        fetch("./" + amount + "-users.json").then(data => {
           data.json().then(j => {
            userData = j
            updateUserDataStatus();
          });
        })
      })
    }
    setLoadDataButton(10000);
    setLoadDataButton(25000);
    setLoadDataButton(50000);
    setLoadDataButton(100000);
    setLoadDataButton(500000);

    document.getElementById("btn-test-assign").addEventListener("click", function(){
      if(userData === undefined){
        return;
      }
      const t1 = performance.now();
      const result = Object.assign({}, ...userData);
      const t2 = performance.now();
      document.getElementById("textarea-test-assign").value = JSON.stringify(result, null, "\t")
      document.getElementById("btn-test-assign").textContent = t2 - t1;
    })

    document.getElementById("btn-test-accumulator").addEventListener("click", function(){
      if(userData === undefined){
        return;
      }
      const t1 = performance.now();
      const ac = ObjectAccumulator.Accumulator.from(userData);
      const result = ac.m();
      const t2 = performance.now();
      document.getElementById("textarea-test-accumulator").value = JSON.stringify(result, null, "\t")
      document.getElementById("btn-test-accumulator").textContent = t2 - t1;
    })

    document.getElementById("btn-test-deepmerge").addEventListener("click", function(){
      if(userData === undefined){
        return;
      }
      const t1 = performance.now();
      const result = deepmerge.all(userData);
      const t2 = performance.now();
      document.getElementById("textarea-test-deepmerge").value = JSON.stringify(result, null, "\t")
      document.getElementById("btn-test-deepmerge").textContent = t2 - t1;
    })

    document.getElementById("btn-test-map").addEventListener("click", function(){
      if(userData === undefined){
        return;
      }
      const t1 = performance.now();
      const map = new Map(...userData.map(user => Object.entries(user)));
      const obj = Object.fromEntries(map)
      const t2 = performance.now();
      document.getElementById("btn-test-map").textContent = t2 - t1;
      alert(JSON.stringify(obj))
    })

    updateUserDataStatus();
  </script>
</body>
</html>
